# Activity Log

[![The Whole Fruit Manifesto](https://img.shields.io/badge/writing%20standard-the%20whole%20fruit-brightgreen)](https://github.com/the-whole-fruit/manifesto)

This package adds a web interface that shows the activity log for projects that use [Backpack for Laravel](https://backpackforlaravel.com/). It relies on Spatie `laravel-activitylog` package, if you need further information on how to use it, head to https://spatie.be/docs/laravel-activitylog/.

How does it all work? Well:
- when a change happens to an Eloquent model, the Spatie package will make a note of it in the database;
- this package adds a web interface, so the admin can see the changes (aka activity log);

## Preview

![](https://user-images.githubusercontent.com/1032474/205863022-827f3248-a9f3-4d05-896f-5fa7a40227be.gif)

Don't belive how simple it is to use? Go ahead, try it right now, in [our online demo](https://demo.backpackforlaravel.com/admin/activity-log).  Edit some other entities, and check the [activity logs](https://demo.backpackforlaravel.com/admin/activity-log) page to see the changes.

## Installation

In your Laravel + Backpack project:

```bash
# install the package
composer require backpack/activity-log

# publish and run the migrations
php artisan vendor:publish --provider="Spatie\Activitylog\ActivitylogServiceProvider" --tag="activitylog-migrations"
php artisan migrate

# optional: publish the config file
php artisan vendor:publish --provider="Spatie\Activitylog\ActivitylogServiceProvider" --tag="activitylog-config"

# optional: add a sidebar entry item for the Activity Logs page
php artisan backpack:add-sidebar-content "<li class='nav-item'><a class='nav-link' href='{{ backpack_url('activity-log') }}'><i class='nav-icon la la-stream'></i> Activity Logs</a></li>"
```

## Usage

Inside all the Models you want to be logged, add the usage of the `LogsActivity` Trait:

```diff
<?php

namespace App\Models;

use Backpack\CRUD\app\Models\Traits\CrudTrait;
+use Backpack\ActivityLog\Traits\LogsActivity;

class Article extends Model
{
    use CrudTrait;
+   use LogsActivity;
    ...
```

If you want to show the activity log shortcut button on crud, enable each button with:

```diff
<?php

namespace App\Http\Controllers\Admin;

...

class ArticleCrudController extends CrudController
{
    ...
+    use \Backpack\ActivityLog\Http\Controllers\Operations\ShowModelActivityLogsOperation;
+    use \Backpack\ActivityLog\Http\Controllers\Operations\ShowEntryActivityLogsOperation;
    ...
```

The `ShowModelActivityLogsOperation` will enable the button for the entire Model, you'll see the list of all the activity generated by this Model.  
The `ShowEntryActivityLogsOperation` will enable the button for the each entry in the list with a line button, you'll see the activity for that specific entry.


This package also providee shortcuts for **Causers**, which are the entities who cause activities on other entities. Most of the times the causers will only be users, but you may have other entities trigering changes.  
If you want to show the activity log shortcut button on **causers**, enable each button with:

```diff
<?php

namespace App\Http\Controllers\Admin;

...

class ExampleCrudController extends CrudController
{
    ...
+    use \Backpack\ActivityLog\Http\Controllers\Operations\ShowCauserModelActivityLogsOperation;
+    use \Backpack\ActivityLog\Http\Controllers\Operations\ShowCauserEntryActivityLogsOperation;
    ...
```

Quick note, if you haven't yet costumized your UserCrudController, you can do it by binding the backpack controller to a custom one.


`App\Providers\AppServiceProvider.php`
```php
class AppServiceProvider extends ServiceProvider
{
    public function register()
    {
        $this->app->bind(
            \Backpack\PermissionManager\app\Http\Controllers\UserCrudController::class,
            \App\Http\Controllers\Admin\UserCrudController::class
        );
```

`App\Http\Controllers\Admin\UserCrudController.php`
```php
use Backpack\PermissionManager\app\Http\Controllers\UserCrudController as OriginalUserCrudController;

class UserCrudController extends OriginalUserCrudController
{
    use \Backpack\ActivityLog\Http\Controllers\Operations\ShowCauserModelActivityLogsOperation;
    use \Backpack\ActivityLog\Http\Controllers\Operations\ShowCauserEntryActivityLogsOperation;
}
```

## FAQ

#### What gets logged by default?

By default backpack activity logger will log the **fillable fields** and only **the ones that were changed**.

#### How do you customize what gets logged?

You can costumize what gets logged by overriding the `getActivitylogOptions` on your models.

```php
public function getActivitylogOptions(): LogOptions
{
    return LogOptions::defaults()
        ->logFillable()
        ->logOnlyDirty();
}
```

## Security

If you discover any security related issues, please email cristian.tabacitu@backpackforlaravel.com instead of using the issue tracker.

## Credits

- [Antonio Almeida](https://github.com/promatik)
- [Cristian Tabacitu](https://github.com/tabacitu)
- [All Contributors][link-contributors]

## License

This project was released under EULA, so you can install it on top of any Backpack & Laravel project. Please see the [license file](license.md) for more information. 

[ico-version]: https://img.shields.io/packagist/v/backpack/activity-log.svg?style=flat-square
[ico-downloads]: https://img.shields.io/packagist/dt/backpack/activity-log.svg?style=flat-square
[link-author]: https://github.com/backpack
[link-contributors]: ../../contributors
